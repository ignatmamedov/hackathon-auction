### Create a new bid successfully /api/bids - 201
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user1_token}}

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 1100
}

> {%
    client.test("Bid created successfully", function () {
        client.assert(response.status === 201, "Response is not 201");
        client.assert(response.body.bid != null, "Bid not returned");
        client.assert(response.body.message.match(/created successfully/i), "No success message");
        client.global.set("bid_id", response.body.bid.id);
    });
%}

### Try to place a second bid on the same lot /api/bids - 400
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user1_token}}

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 1300
}

> {%
    client.test("User cannot place a second bid on the same lot", function () {
        client.assert(response.status === 400, "Response is not 400");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/You have already placed a bid on this lot/i), "No 'already placed bid' message");
    });
%}

### Create a bid with an invalid token /api/bids - 401
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer sljfnsfjnlsdnmfsl

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 1200
}

> {%
    client.test("Unauthorized due to invalid token", function () {
        client.assert(response.status === 401, "Response is not 401");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/authentication token/i), "No authentication token error message");
    });
%}

### Create a bid without a token /api/bids - 401
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 1200
}

> {%
    client.test("Unauthorized due to missing token", function () {
        client.assert(response.status === 401, "Response is not 401");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/authentication token/i), "No authentication token error message");
    });
%}

### Create a bid with expired auction /api/bids - 400
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user1_token}}

{
  "lotId": "6b70425a-d0ab-4f4c-a091-1d0356e7bc41",
  "amount": 1300
}

> {%
    client.test("Bid not allowed on expired lot", function () {
        client.assert(response.status === 400, "Response is not 400");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/auction for this lot has ended/i), "No 'auction ended' message");
    });
%}

### Create a bid on a lot that doesn't exist /api/bids - 404
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user1_token}}

{
  "lotId": "nonexistent-lot-id",
  "amount": 1500
}

> {%
    client.test("Lot not found error", function () {
        client.assert(response.status === 404, "Response is not 404");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/lot with id .* not found/i), "No 'not found' message");
    });
%}

### Create a bid with amount lower than current bid /api/bids - 400
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user2_token}}

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 900
}

> {%
    client.test("Bid amount too low", function () {
        client.assert(response.status === 400, "Response is not 400");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/must be higher than the current highest bid/i), "No 'bid too low' message");
    });
%}

### Create a bid with invalid JSON /api/bids - 400
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{user1_token}}

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79"
  "amount": 1200
}

> {%
    client.test("Invalid JSON format error", function () {
        client.assert(response.status === 400, "Response is not 400");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/Invalid JSON format/i), "No 'Invalid JSON format' message");
    });
%}

### Create a bid as an admin /api/bids - 403
POST {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{admin_token}}

{
  "lotId": "281ed63c-e3a9-476f-bed8-92b219444e79",
  "amount": 1200
}

> {%
    client.test("Admins are not allowed to place bids", function () {
        client.assert(response.status === 403, "Response is not 403");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/admins are not allowed to perform this action/i), "No 'forbidden for admin' message");
    });
%}

### Get all bids for the authenticated user /api/bids - 200
GET {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Accept: application/json
Authorization: Bearer {{user1_token}}

> {%
    client.test("Retrieve user bids successfully", function () {
        client.assert(response.status === 200, "Response is not 200");
        client.assert(Array.isArray(response.body), "Response is not an array");
        client.assert(response.body.length > 0, "No bids returned");
    });
%}

### Get all bids for the authenticated user with invalid token /api/bids - 401
GET {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Accept: application/json
Authorization: Bearer sdfsdfsdfsdf

> {%
    client.test("Unauthorized due to invalid token", function () {
        client.assert(response.status === 401, "Response is not 401");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/authentication token/i), "No authentication token error message");
    });
%}


### Get all bids for the authenticated user without token /api/bids - 401
GET {{protocol}}//{{host}}:{{port}}/{{default_path}}/bids
Accept: application/json

> {%
    client.test("Unauthorized due to missing token", function () {
        client.assert(response.status === 401, "Response is not 401");
        client.assert(response.body.error != null, "Error not returned");
        client.assert(response.body.error.message.match(/authentication token/i), "No authentication token error message");
    });
%}
